import './polyfills.server.mjs';
import{m as j}from"./chunk-MJPLGBXN.mjs";import{n as y,o as k,p as D,q as A,r as E,u as l}from"./chunk-EYPCSYAF.mjs";import{Ga as c,Ha as b,N as C,S,Ua as I,Wa as d,X as P,Za as n,_a as a,a as _,ab as x,bb as m,cb as p,db as i,eb as O,fa as u,g as v,ga as f,hb as M,va as h}from"./chunk-D7ZWPOEP.mjs";import{h as g}from"./chunk-5XUXGTUW.mjs";var w=class r{constructor(t){this.platformId=t;l(this.platformId)&&(this.initializePwaPrompt(),this.checkIfInstalled())}promptEvent=null;isInstallableSubject=new v(!1);isInstalledSubject=new v(!1);isInstallable$=this.isInstallableSubject.asObservable();isInstalled$=this.isInstalledSubject.asObservable();initializePwaPrompt(){window.addEventListener("beforeinstallprompt",t=>{console.log("[PWA] beforeinstallprompt event fired"),t.preventDefault(),this.promptEvent=t,this.isInstallableSubject.next(!0)}),window.addEventListener("appinstalled",()=>{console.log("[PWA] App successfully installed"),this.isInstalledSubject.next(!0),this.isInstallableSubject.next(!1),this.promptEvent=null}),this.isRunningStandalone()&&this.isInstalledSubject.next(!0)}checkIfInstalled(){let t=this.isRunningStandalone(),e=window.matchMedia("(display-mode: standalone)").matches,s=/iPad|iPhone|iPod/.test(navigator.userAgent)&&navigator.standalone;(t||e||s)&&(console.log("[PWA] App detected as already installed"),this.isInstalledSubject.next(!0))}promptInstall(){return g(this,null,function*(){if(!this.promptEvent)return console.warn("[PWA] No install prompt available"),!1;try{this.promptEvent.prompt();let t=yield this.promptEvent.userChoice;return console.log("[PWA] User choice:",t),t.outcome==="accepted"?(console.log("[PWA] User accepted the install prompt"),this.isInstallableSubject.next(!1),!0):(console.log("[PWA] User dismissed the install prompt"),!1)}catch(t){return console.error("[PWA] Error prompting install:",t),!1}finally{this.promptEvent=null}})}isRunningStandalone(){return l(this.platformId)?window.matchMedia("(display-mode: standalone)").matches||navigator.standalone||document.referrer.includes("android-app://")||navigator.standalone===!0:!1}canInstall(){return this.promptEvent!==null}isInstalled(){return this.isInstalledSubject.value}isInstallable(){return this.isInstallableSubject.value}getPlatformInstallInstructions(){if(!l(this.platformId))return"Instrucciones disponibles en el navegador";let t=navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(t)?'iOS: Toca el bot\xF3n de compartir y selecciona "A\xF1adir a la pantalla de inicio"':/android/.test(t)?/chrome/.test(t)?'Android Chrome: Toca el men\xFA (3 puntos) y selecciona "A\xF1adir a la pantalla de inicio"':/firefox/.test(t)?'Android Firefox: Toca el men\xFA y selecciona "Instalar"':'Android: Busca la opci\xF3n "A\xF1adir a la pantalla de inicio" en el men\xFA del navegador':/windows/.test(t)?"Windows: Haz clic en el icono de instalaci\xF3n en la barra de direcciones":/mac/.test(t)?"Mac: Haz clic en el icono de instalaci\xF3n en la barra de direcciones":'Busca la opci\xF3n "Instalar app" o "A\xF1adir a la pantalla de inicio" en tu navegador'}isPwaSupported(){return l(this.platformId)?"serviceWorker"in navigator&&"PushManager"in window:!1}getPwaStatus(){if(!l(this.platformId))return{isSupported:!1,isInstallable:!1,isInstalled:!1,canPrompt:!1,platform:"server"};let t=navigator.userAgent.toLowerCase(),e="unknown";return/iphone|ipad|ipod/.test(t)?e="ios":/android/.test(t)?e="android":/windows/.test(t)?e="windows":/mac/.test(t)?e="mac":e="desktop",{isSupported:this.isPwaSupported(),isInstallable:this.isInstallable(),isInstalled:this.isInstalled(),canPrompt:this.canInstall(),platform:e}}static \u0275fac=function(e){return new(e||r)(S(h))};static \u0275prov=C({token:r,factory:r.\u0275fac,providedIn:"root"})};function F(r,t){if(r&1){let e=x();n(0,"div",3)(1,"div",4)(2,"div",5),i(3,"\u{1F4F1}"),a(),n(4,"div",6)(5,"h4"),i(6,"Instalar Tarjeta Digital"),a(),n(7,"p"),i(8,"Acceso r\xE1pido desde tu pantalla de inicio"),a()(),n(9,"div",7)(10,"button",8),m("click",function(){u(e);let s=p();return f(s.installApp())}),i(11," Instalar "),a(),n(12,"button",9),m("click",function(){u(e);let s=p();return f(s.dismissBanner())}),i(13," \u2715 "),a()()()()}}function V(r,t){if(r&1){let e=x();n(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13),i(4,"\u{1F517}"),a(),n(5,"div",14)(6,"h4"),i(7,"Acceso R\xE1pido"),a(),n(8,"p"),i(9,"A\xF1ade esta tarjeta a tu pantalla de inicio"),a()(),n(10,"button",15),m("click",function(){u(e);let s=p();return f(s.dismissDirectShortcut())}),i(11," \u2715 "),a()(),n(12,"div",16)(13,"button",17),m("click",function(){u(e);let s=p();return f(s.createDirectShortcut())}),n(14,"span",18),i(15,"\u{1F4F1}"),a(),i(16," Crear Acceso Directo "),a()()()()}}function U(r,t){r&1&&(n(0,"div",27)(1,"div",28)(2,"span",29),i(3,"1"),a(),n(4,"span",30),i(5,"Toca el bot\xF3n de compartir "),n(6,"span",31),i(7,"\u{1F4E4}"),a()()(),n(8,"div",28)(9,"span",29),i(10,"2"),a(),n(11,"span",30),i(12,'Selecciona "A\xF1adir a la pantalla de inicio"'),a()()())}function $(r,t){r&1&&(n(0,"div",27)(1,"div",28)(2,"span",29),i(3,"1"),a(),n(4,"span",30),i(5,"Toca el men\xFA "),n(6,"span",31),i(7,"\u22EE"),a()()(),n(8,"div",28)(9,"span",29),i(10,"2"),a(),n(11,"span",30),i(12,'Selecciona "A\xF1adir a la pantalla de inicio"'),a()()())}function R(r,t){r&1&&(n(0,"div",27)(1,"div",28)(2,"span",29),i(3,"1"),a(),n(4,"span",30),i(5,"Busca el icono de instalaci\xF3n en la barra de direcciones"),a()(),n(6,"div",28)(7,"span",29),i(8,"2"),a(),n(9,"span",30),i(10,'Haz clic en "Instalar" cuando aparezca'),a()()())}function W(r,t){if(r&1){let e=x();n(0,"div",19)(1,"div",20)(2,"div",21)(3,"div",22),i(4,"\u{1F4A1}"),a(),n(5,"h4"),i(6,"A\xF1adir a pantalla de inicio"),a(),n(7,"button",15),m("click",function(){u(e);let s=p();return f(s.dismissManualInstructions())}),i(8," \u2715 "),a()(),n(9,"p",23),i(10),a(),n(11,"div",24),I(12,U,13,0,"div",25)(13,$,13,0,"div",25)(14,R,11,0,"div",26),a()()()}if(r&2){let e=p();c(10),O(e.installInstructions),c(),d("ngSwitch",e.pwaStatus.platform),c(),d("ngSwitchCase","ios"),c(),d("ngSwitchCase","android")}}var z=class r{constructor(t,e,o){this.pwaService=t;this.router=e;this.platformId=o}userCard=null;showInstallBanner=!1;showManualInstructions=!1;isInstalled=!1;installInstructions="";pwaStatus={};currentCardUrl="";showDirectShortcut=!1;subscriptions=new _;ngOnInit(){this.currentCardUrl=this.getCurrentCardUrl(),this.subscriptions.add(this.pwaService.isInstallable$.subscribe(t=>{this.showInstallBanner=t&&!this.isInstalled&&this.shouldShowBanner()})),this.subscriptions.add(this.pwaService.isInstalled$.subscribe(t=>{this.isInstalled=t,t&&(this.showInstallBanner=!1,this.showManualInstructions=!1)})),this.pwaStatus=this.pwaService.getPwaStatus(),this.installInstructions=this.getCustomInstallInstructions(),this.userCard&&!this.pwaStatus.isInstalled&&(this.showDirectShortcut=!0),this.pwaStatus.isSupported&&!this.pwaStatus.canPrompt&&!this.pwaStatus.isInstalled&&!this.userCard&&setTimeout(()=>{this.showManualInstructions=!0},3e3)}ngOnDestroy(){this.subscriptions.unsubscribe()}installApp(){return g(this,null,function*(){(yield this.pwaService.promptInstall())&&(this.showInstallBanner=!1)})}dismissBanner(){this.showInstallBanner=!1,typeof localStorage<"u"&&localStorage.setItem("pwa-install-dismissed",Date.now().toString())}dismissManualInstructions(){this.showManualInstructions=!1}shouldShowBanner(){if(typeof localStorage>"u")return!0;let t=localStorage.getItem("pwa-install-dismissed");if(!t)return!0;let e=parseInt(t),o=Date.now()-7*24*60*60*1e3;return e<o}getCurrentCardUrl(){return l(this.platformId)?window.location.href:""}getCustomInstallInstructions(){return l(this.platformId)?this.userCard?`A\xF1ade la tarjeta de ${this.userCard.name||this.userCard.nombre||"esta tarjeta"} a tu pantalla de inicio para acceso r\xE1pido`:this.pwaService.getPlatformInstallInstructions():"Instrucciones disponibles en el navegador"}createDirectShortcut(){if(!l(this.platformId))return;let t=navigator.userAgent.toLowerCase(),e=this.userCard?.name||this.userCard?.nombre||"Tarjeta Digital";/iphone|ipad|ipod/.test(t)?this.showIOSShortcutInstructions(e):/android/.test(t)?this.createAndroidShortcut(e):this.createDesktopShortcut(e)}showIOSShortcutInstructions(t){alert(`Para a\xF1adir la tarjeta de ${t} a tu pantalla de inicio:

1. Toca el bot\xF3n Compartir (\u{1F4E4})
2. Despl\xE1zate y selecciona "A\xF1adir a pantalla de inicio"
3. Confirma el nombre y toca "A\xF1adir"`)}createAndroidShortcut(t){"BeforeInstallPromptEvent"in window?this.installApp():alert(`Para a\xF1adir la tarjeta de ${t} a tu pantalla de inicio:

1. Toca el men\xFA (\u22EE) del navegador
2. Selecciona "A\xF1adir a pantalla de inicio"
3. Confirma el nombre y toca "A\xF1adir"`)}createDesktopShortcut(t){if(confirm(`\xBFDeseas a\xF1adir la tarjeta de ${t} a tus favoritos para acceso r\xE1pido?`))try{window.external?.AddFavorite?.(this.currentCardUrl,`Tarjeta de ${t}`)}catch{alert(`Para acceso r\xE1pido a la tarjeta de ${t}:

1. Presiona Ctrl+D (Cmd+D en Mac) para a\xF1adir a favoritos
2. O busca el icono de instalaci\xF3n en la barra de direcciones`)}}dismissDirectShortcut(){if(this.showDirectShortcut=!1,typeof localStorage<"u"&&this.userCard){let t=this.userCard.id||this.userCard.usuario_id||"unknown";localStorage.setItem(`pwa-shortcut-dismissed-${t}`,Date.now().toString())}}static \u0275fac=function(e){return new(e||r)(b(w),b(j),b(h))};static \u0275cmp=P({type:r,selectors:[["app-pwa-install"]],inputs:{userCard:"userCard"},standalone:!0,features:[M],decls:3,vars:3,consts:[["class","pwa-install-banner",4,"ngIf"],["class","pwa-direct-shortcut",4,"ngIf"],["class","pwa-manual-instructions",4,"ngIf"],[1,"pwa-install-banner"],[1,"banner-content"],[1,"banner-icon"],[1,"banner-text"],[1,"banner-actions"],[1,"install-btn",3,"click"],["aria-label","Cerrar",1,"dismiss-btn",3,"click"],[1,"pwa-direct-shortcut"],[1,"shortcut-content"],[1,"shortcut-header"],[1,"shortcut-icon"],[1,"shortcut-text"],["aria-label","Cerrar",1,"close-btn",3,"click"],[1,"shortcut-actions"],[1,"shortcut-btn",3,"click"],[1,"btn-icon"],[1,"pwa-manual-instructions"],[1,"instructions-content"],[1,"instructions-header"],[1,"instructions-icon"],[1,"instructions-text"],[1,"platform-steps",3,"ngSwitch"],["class","platform-guide",4,"ngSwitchCase"],["class","platform-guide",4,"ngSwitchDefault"],[1,"platform-guide"],[1,"step"],[1,"step-number"],[1,"step-text"],[1,"icon-demo"]],template:function(e,o){e&1&&I(0,F,14,0,"div",0)(1,V,17,0,"div",1)(2,W,15,4,"div",2),e&2&&(d("ngIf",o.showInstallBanner),c(),d("ngIf",o.showDirectShortcut&&o.userCard),c(),d("ngIf",o.showManualInstructions))},dependencies:[E,y,k,D,A],styles:[".pwa-install-banner[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:20px;right:20px;z-index:1000;max-width:400px;margin:0 auto;animation:_ngcontent-%COMP%_slideInUp .3s ease-out}.banner-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:16px 20px;border-radius:16px;box-shadow:0 8px 32px #0000004d;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}.banner-icon[_ngcontent-%COMP%]{font-size:2rem;flex-shrink:0}.banner-text[_ngcontent-%COMP%]{flex:1}.banner-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;margin:0 0 4px}.banner-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;margin:0;opacity:.9}.banner-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.install-btn[_ngcontent-%COMP%]{background:#fff3;border:1px solid rgba(255,255,255,.3);color:#fff;padding:8px 16px;border-radius:20px;font-size:.9rem;font-weight:500;cursor:pointer;transition:all .3s ease}.install-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d;transform:translateY(-1px)}.dismiss-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#ffffffb3;font-size:1.2rem;cursor:pointer;padding:4px;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.dismiss-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.pwa-direct-shortcut[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:20px;right:20px;z-index:1000;max-width:400px;margin:0 auto;animation:_ngcontent-%COMP%_slideInUp .3s ease-out}.shortcut-content[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);color:#fff;padding:20px;border-radius:16px;box-shadow:0 8px 32px #10b9814d;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}.shortcut-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px;margin-bottom:16px}.shortcut-icon[_ngcontent-%COMP%]{font-size:2rem;flex-shrink:0}.shortcut-text[_ngcontent-%COMP%]{flex:1}.shortcut-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;margin:0 0 4px}.shortcut-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.95rem;margin:0;opacity:.9}.shortcut-actions[_ngcontent-%COMP%]{display:flex;justify-content:center}.shortcut-btn[_ngcontent-%COMP%]{background:#fff3;border:1px solid rgba(255,255,255,.3);color:#fff;padding:12px 24px;border-radius:25px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:8px}.shortcut-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d;transform:translateY(-2px);box-shadow:0 4px 12px #0003}.btn-icon[_ngcontent-%COMP%]{font-size:1.1rem}.pwa-manual-instructions[_ngcontent-%COMP%]{position:fixed;top:20px;left:20px;right:20px;z-index:1000;max-width:450px;margin:0 auto;animation:_ngcontent-%COMP%_slideInDown .3s ease-out}.instructions-content[_ngcontent-%COMP%]{background:#000000e6;color:#fff;padding:20px;border-radius:16px;box-shadow:0 8px 32px #00000080;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.1)}.instructions-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:16px;position:relative}.instructions-icon[_ngcontent-%COMP%]{font-size:1.5rem}.instructions-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{flex:1;font-size:1.2rem;font-weight:600;margin:0}.close-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#ffffffb3;font-size:1.2rem;cursor:pointer;padding:4px;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.instructions-text[_ngcontent-%COMP%]{font-size:.95rem;line-height:1.5;margin:0 0 16px;opacity:.9}.platform-guide[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.step[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px}.step-number[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0ff,#8000ff);color:#fff;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.8rem;font-weight:600;flex-shrink:0}.step-text[_ngcontent-%COMP%]{font-size:.9rem;line-height:1.4;padding-top:2px}.icon-demo[_ngcontent-%COMP%]{background:#ffffff1a;padding:2px 6px;border-radius:4px;margin:0 4px;font-size:.8rem}@keyframes _ngcontent-%COMP%_slideInUp{0%{opacity:0;transform:translateY(100px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slideInDown{0%{opacity:0;transform:translateY(-100px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 480px){.pwa-install-banner[_ngcontent-%COMP%]{left:16px;right:16px;bottom:16px}.banner-content[_ngcontent-%COMP%]{padding:14px 16px;gap:12px}.banner-icon[_ngcontent-%COMP%]{font-size:1.5rem}.banner-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1rem}.banner-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.85rem}.pwa-manual-instructions[_ngcontent-%COMP%]{left:16px;right:16px;top:16px}.instructions-content[_ngcontent-%COMP%]{padding:18px}}@media (prefers-color-scheme: dark){.instructions-content[_ngcontent-%COMP%]{background:#141414f2;border:1px solid rgba(255,255,255,.15)}}@media (prefers-contrast: high){.banner-content[_ngcontent-%COMP%], .instructions-content[_ngcontent-%COMP%], .install-btn[_ngcontent-%COMP%]{border:2px solid white}}"]})};export{z as a};
