import{a as q,b as p,c as H,d as R,e as A,f as B,g as J,i as K,j as Q,k as W}from"./chunk-XYBQ7NNP.js";import{a as V,b as te}from"./chunk-CWXLNJO2.js";import"./chunk-ZXGACRG4.js";import{a as w,b as ee}from"./chunk-3FZOACPW.js";import"./chunk-M65OZ3ZA.js";import{D as Z,l as j,p as G,v as O,w as $,x as D}from"./chunk-Q7AIZQEA.js";import{$ as P,Ia as N,Kb as z,Ma as a,Va as c,_a as m,ab as l,bb as h,d as Y,da as U,db as t,eb as r,fb as f,hb as u,ib as M,jb as n,kb as L,lb as I,nb as k}from"./chunk-PKDUKL24.js";function re(o,i){if(o&1&&(t(0,"div",37)(1,"span",38),n(2),r()()),o&2){let s=M();a(2),L(s.successMessage())}}function ie(o,i){if(o&1&&(t(0,"div",39)(1,"span",38),n(2),r()()),o&2){let s=M();a(2),L(s.errorMessage())}}function ne(o,i){o&1&&(t(0,"div",40)(1,"span",41),n(2,"person"),r()())}function oe(o,i){o&1&&(t(0,"span",42),n(1,"refresh"),r())}function ae(o,i){o&1&&(t(0,"p",43),n(1," El nombre es obligatorio "),r())}function se(o,i){o&1&&(t(0,"p",43),n(1," Introduce un correo electr\xF3nico v\xE1lido "),r())}function le(o,i){o&1&&(t(0,"span",42),n(1,"refresh"),r())}function de(o,i){o&1&&(t(0,"p",43),n(1," La contrase\xF1a actual es obligatoria "),r())}function me(o,i){o&1&&(t(0,"p",43),n(1," La nueva contrase\xF1a es obligatoria "),r())}function pe(o,i){o&1&&(t(0,"p",43),n(1," La contrase\xF1a debe tener al menos 8 caracteres "),r())}function ue(o,i){o&1&&(t(0,"p",43),n(1," Confirma tu contrase\xF1a "),r())}function ce(o,i){o&1&&(t(0,"p",43),n(1," Las contrase\xF1as no coinciden "),r())}function fe(o,i){o&1&&(t(0,"span",42),n(1,"refresh"),r())}var X,ge=Y(()=>{z();O();W();te();Z();ee();z();O();W();X=class o{authService=P(V);fb=P(K);http=P(D);profileForm;passwordForm;isLoading=c(!1);successMessage=c("");errorMessage=c("");selectedFile=null;previewUrl=null;showCurrentPassword=c(!1);showNewPassword=c(!1);showConfirmPassword=c(!1);currentUser=null;ngOnInit(){this.currentUser=this.authService.currentUser(),this.initForms(),this.loadProfileImage()}getAuthHeaders(){let i=this.authService.getToken();return{headers:new $({Authorization:`Bearer ${i}`})}}initForms(){this.profileForm=this.fb.group({name:[this.currentUser?.name||"",[p.required]],email:[this.currentUser?.email||"",[p.required,p.email]],rol:[this.currentUser?.rol||"",[p.required]]}),this.passwordForm=this.fb.group({current_password:["",[p.required,p.minLength(8)]],password:["",[p.required,p.minLength(8)]],password_confirmation:["",[p.required]]},{validators:this.passwordMatchValidator})}togglePasswordVisibility(i){i==="current"?this.showCurrentPassword.set(!this.showCurrentPassword()):i==="new"?this.showNewPassword.set(!this.showNewPassword()):i==="confirm"&&this.showConfirmPassword.set(!this.showConfirmPassword())}passwordMatchValidator(i){let s=i.get("password")?.value,e=i.get("password_confirmation")?.value;return s===e?null:{mismatch:!0}}loadProfileImage(){if(!this.currentUser)return;let i=w.urlRaiz.replace(/\/api$/,"");this.previewUrl=`${i}/assets/images/profiles/${this.currentUser.id}.jpg?t=${new Date().getTime()}`}onFileSelected(i){let s=i.target;if(s.files&&s.files.length){let e=s.files[0];if(!e.type.match(/image\/(jpeg|jpg|png)/)){this.errorMessage.set("Solo se permiten archivos JPG o PNG");return}if(e.size>2*1024*1024){this.errorMessage.set("La imagen no debe superar los 2MB");return}this.selectedFile=e,this.previewUrl=URL.createObjectURL(e),this.errorMessage.set("")}}uploadImage(){if(!this.selectedFile||!this.currentUser)return;let i=new FormData;i.append("profile_image",this.selectedFile),this.isLoading.set(!0),this.http.post(`${w.urlRaiz}/auth/profile-image`,i,this.getAuthHeaders()).subscribe({next:s=>{this.successMessage.set("Imagen de perfil actualizada correctamente"),this.isLoading.set(!1),this.selectedFile=null;let e=w.urlRaiz.replace(/\/api$/,"");this.previewUrl=`${e}/assets/images/profiles/${this.currentUser?.id}.jpg?t=${new Date().getTime()}`},error:s=>{this.errorMessage.set(s.error.message||"Error al subir la imagen"),this.isLoading.set(!1)}})}updateProfile(){if(this.profileForm.invalid)return;this.isLoading.set(!0),this.errorMessage.set(""),this.successMessage.set("");let i=this.profileForm.value;console.log("Enviando actualizaci\xF3n de perfil:",i),this.http.put(`${w.urlRaiz}/auth/profile`,i,this.getAuthHeaders()).subscribe({next:s=>{this.successMessage.set("Perfil actualizado correctamente"),this.isLoading.set(!1),s.data&&(this.authService.currentUser.set(s.data),this.currentUser=s.data)},error:s=>{console.error("Error al actualizar perfil:",s),this.errorMessage.set(s.error?.message||"Error al actualizar el perfil"),this.isLoading.set(!1)}})}updatePassword(){if(this.passwordForm.invalid)return;this.isLoading.set(!0),this.errorMessage.set(""),this.successMessage.set("");let i=this.passwordForm.value;console.log("Enviando actualizaci\xF3n de contrase\xF1a:",i),this.http.put(`${w.urlRaiz}/auth/change-password`,i,this.getAuthHeaders()).subscribe({next:()=>{this.successMessage.set("Contrase\xF1a actualizada correctamente"),this.isLoading.set(!1),this.passwordForm.reset(),this.showCurrentPassword.set(!1),this.showNewPassword.set(!1),this.showConfirmPassword.set(!1)},error:s=>{console.error("Error al actualizar contrase\xF1a:",s),this.errorMessage.set(s.error?.message||"Error al actualizar la contrase\xF1a"),this.isLoading.set(!1)}})}static \u0275fac=function(s){return new(s||o)};static \u0275cmp=U({type:o,selectors:[["app-cuenta"]],standalone:!0,features:[k],decls:82,vars:35,consts:[[1,"max-w-6xl","mx-auto"],[1,"text-2xl","font-bold","text-gray-800","mb-6"],["class","bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4",4,"ngIf"],["class","bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6"],[1,"bg-white","rounded-lg","shadow-md","p-6"],[1,"text-xl","font-semibold","text-gray-700","mb-4"],[1,"flex","flex-col","items-center"],[1,"w-32","h-32","bg-gray-200","rounded-full","overflow-hidden","mb-4"],["alt","Foto de perfil",1,"w-full","h-full","object-cover",3,"error","src"],["class","w-full h-full flex items-center justify-center",4,"ngIf"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","cursor-pointer","mb-2"],["type","file","accept","image/jpeg,image/jpg,image/png",1,"hidden",3,"change"],[1,"text-sm","text-gray-500","mb-4"],[1,"px-4","py-2","bg-green-600","text-white","rounded-md","hover:bg-green-700","disabled:bg-green-300","w-full",3,"click","disabled"],["class","material-icons animate-spin mr-1",4,"ngIf"],[1,"bg-white","rounded-lg","shadow-md","p-6","md:col-span-2"],[1,"space-y-4",3,"ngSubmit","formGroup"],["for","name",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","text","id","name","formControlName","name",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-1","focus:ring-blue-500"],["class","mt-1 text-sm text-red-600",4,"ngIf"],["for","email",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","email","id","email","formControlName","email",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-1","focus:ring-blue-500"],["type","hidden","formControlName","rol","id","rol"],[1,"flex","justify-end"],["type","submit",1,"px-4","py-2","bg-blue-600","text-white","rounded-md","hover:bg-blue-700","disabled:bg-blue-300",3,"disabled"],[1,"bg-white","rounded-lg","shadow-md","p-6","md:col-span-3"],["for","current_password",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"relative"],["id","current_password","formControlName","current_password",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-1","focus:ring-blue-500","pr-10",3,"type"],["type","button",1,"absolute","inset-y-0","right-0","pr-3","flex","items-center","text-gray-600",3,"click"],[1,"material-icons","text-gray-500"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],["for","password",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","password","formControlName","password",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-1","focus:ring-blue-500","pr-10",3,"type"],["for","password_confirmation",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["id","password_confirmation","formControlName","password_confirmation",1,"w-full","px-3","py-2","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-1","focus:ring-blue-500","pr-10",3,"type"],[1,"bg-green-100","border","border-green-400","text-green-700","px-4","py-3","rounded","relative","mb-4"],[1,"block","sm:inline"],[1,"bg-red-100","border","border-red-400","text-red-700","px-4","py-3","rounded","relative","mb-4"],[1,"w-full","h-full","flex","items-center","justify-center"],[1,"material-icons","text-gray-400","text-5xl"],[1,"material-icons","animate-spin","mr-1"],[1,"mt-1","text-sm","text-red-600"]],template:function(s,e){if(s&1&&(t(0,"div",0)(1,"h1",1),n(2,"Configuraci\xF3n de Cuenta"),r(),m(3,re,3,1,"div",2)(4,ie,3,1,"div",3),t(5,"div",4)(6,"div",5)(7,"h2",6),n(8,"Imagen de perfil"),r(),t(9,"div",7)(10,"div",8)(11,"img",9),u("error",function(){return e.previewUrl="assets/images/default-profile.jpg"}),r(),m(12,ne,3,0,"div",10),r(),t(13,"label",11)(14,"span"),n(15,"Seleccionar imagen"),r(),t(16,"input",12),u("change",function(g){return e.onFileSelected(g)}),r()(),t(17,"p",13),n(18,"JPG o PNG. M\xE1ximo 2MB."),r(),t(19,"button",14),u("click",function(){return e.uploadImage()}),m(20,oe,2,0,"span",15),t(21,"span"),n(22,"Subir imagen"),r()()()(),t(23,"div",16)(24,"h2",6),n(25," Informaci\xF3n de perfil "),r(),t(26,"form",17),u("ngSubmit",function(){return e.updateProfile()}),t(27,"div")(28,"label",18),n(29,"Nombre"),r(),f(30,"input",19),m(31,ae,2,0,"p",20),r(),t(32,"div")(33,"label",21),n(34,"Correo electr\xF3nico"),r(),f(35,"input",22),m(36,se,2,0,"p",20),r(),f(37,"input",23),t(38,"div",24)(39,"button",25),m(40,le,2,0,"span",15),t(41,"span"),n(42,"Guardar cambios"),r()()()()(),t(43,"div",26)(44,"h2",6),n(45," Cambiar contrase\xF1a "),r(),t(46,"form",17),u("ngSubmit",function(){return e.updatePassword()}),t(47,"div")(48,"label",27),n(49,"Contrase\xF1a actual"),r(),t(50,"div",28),f(51,"input",29),t(52,"button",30),u("click",function(){return e.togglePasswordVisibility("current")}),t(53,"span",31),n(54),r()()(),m(55,de,2,0,"p",20),r(),t(56,"div",32)(57,"div")(58,"label",33),n(59,"Nueva contrase\xF1a"),r(),t(60,"div",28),f(61,"input",34),t(62,"button",30),u("click",function(){return e.togglePasswordVisibility("new")}),t(63,"span",31),n(64),r()()(),m(65,me,2,0,"p",20)(66,pe,2,0,"p",20),r(),t(67,"div")(68,"label",35),n(69,"Confirmar contrase\xF1a"),r(),t(70,"div",28),f(71,"input",36),t(72,"button",30),u("click",function(){return e.togglePasswordVisibility("confirm")}),t(73,"span",31),n(74),r()()(),m(75,ue,2,0,"p",20)(76,ce,2,0,"p",20),r()(),t(77,"div",24)(78,"button",25),m(79,fe,2,0,"span",15),t(80,"span"),n(81,"Cambiar contrase\xF1a"),r()()()()()()()),s&2){let d,g,b,_,v,C,y,F,x,S,E,T;a(3),l("ngIf",e.successMessage()),a(),l("ngIf",e.errorMessage()),a(7),l("src",e.previewUrl,N),a(),l("ngIf",!e.previewUrl),a(7),l("disabled",!e.selectedFile||e.isLoading()),a(),l("ngIf",e.isLoading()&&e.selectedFile),a(6),l("formGroup",e.profileForm),a(4),h("border-red-500",((d=e.profileForm.get("name"))==null?null:d.invalid)&&((d=e.profileForm.get("name"))==null?null:d.touched)),a(),l("ngIf",((g=e.profileForm.get("name"))==null?null:g.invalid)&&((g=e.profileForm.get("name"))==null?null:g.touched)),a(4),h("border-red-500",((b=e.profileForm.get("email"))==null?null:b.invalid)&&((b=e.profileForm.get("email"))==null?null:b.touched)),a(),l("ngIf",((_=e.profileForm.get("email"))==null?null:_.invalid)&&((_=e.profileForm.get("email"))==null?null:_.touched)),a(3),l("disabled",e.profileForm.invalid||e.isLoading()),a(),l("ngIf",e.isLoading()),a(6),l("formGroup",e.passwordForm),a(5),h("border-red-500",((v=e.passwordForm.get("current_password"))==null?null:v.invalid)&&((v=e.passwordForm.get("current_password"))==null?null:v.touched)),l("type",e.showCurrentPassword()?"text":"password"),a(3),I(" ",e.showCurrentPassword()?"visibility_off":"visibility"," "),a(),l("ngIf",((C=e.passwordForm.get("current_password"))==null?null:C.invalid)&&((C=e.passwordForm.get("current_password"))==null?null:C.touched)),a(6),h("border-red-500",((y=e.passwordForm.get("password"))==null?null:y.invalid)&&((y=e.passwordForm.get("password"))==null?null:y.touched)),l("type",e.showNewPassword()?"text":"password"),a(3),I(" ",e.showNewPassword()?"visibility_off":"visibility"," "),a(),l("ngIf",((F=e.passwordForm.get("password"))==null?null:F.hasError("required"))&&((F=e.passwordForm.get("password"))==null?null:F.touched)),a(),l("ngIf",((x=e.passwordForm.get("password"))==null?null:x.hasError("minlength"))&&((x=e.passwordForm.get("password"))==null?null:x.touched)),a(5),h("border-red-500",((S=e.passwordForm.get("password_confirmation"))==null?null:S.invalid)&&((S=e.passwordForm.get("password_confirmation"))==null?null:S.touched)||e.passwordForm.hasError("mismatch")),l("type",e.showConfirmPassword()?"text":"password"),a(3),I(" ",e.showConfirmPassword()?"visibility_off":"visibility"," "),a(),l("ngIf",((E=e.passwordForm.get("password_confirmation"))==null?null:E.hasError("required"))&&((E=e.passwordForm.get("password_confirmation"))==null?null:E.touched)),a(),l("ngIf",e.passwordForm.hasError("mismatch")&&((T=e.passwordForm.get("password_confirmation"))==null?null:T.touched)),a(2),l("disabled",e.passwordForm.invalid||e.isLoading()),a(),l("ngIf",e.isLoading())}},dependencies:[G,j,Q,A,q,H,R,B,J],styles:["@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.animate-spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}button[_ngcontent-%COMP%]:not(:disabled):hover, label[_ngcontent-%COMP%]:hover{transition:all .2s ease-in-out}.rounded-full[_ngcontent-%COMP%]{border:2px solid #e2e8f0}.text-red-600[_ngcontent-%COMP%]{font-size:.875rem}.border-red-500[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #f5656533}"]})}});ge();export{X as CuentaComponent};
