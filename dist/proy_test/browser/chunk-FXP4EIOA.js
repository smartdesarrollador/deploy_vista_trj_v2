import{j as F,p as N}from"./chunk-M65OZ3ZA.js";import{l as z,m as W,n as T,o as B,p as U,r as l,v as x}from"./chunk-Q7AIZQEA.js";import{Da as m,Kb as b,Ma as d,Na as g,P as M,V as k,_ as A,_a as P,ab as u,d as O,da as D,db as n,eb as a,f,g as y,gb as S,hb as _,ib as h,jb as i,kb as j,m as v,na as I,nb as E,oa as C}from"./chunk-PKDUKL24.js";var w,L=O(()=>{"use strict";b();x();M();b();w=class o{constructor(t){this.platformId=t;l(this.platformId)&&(this.initializePwaPrompt(),this.checkIfInstalled())}promptEvent=null;isInstallableSubject=new v(!1);isInstalledSubject=new v(!1);isInstallable$=this.isInstallableSubject.asObservable();isInstalled$=this.isInstalledSubject.asObservable();initializePwaPrompt(){window.addEventListener("beforeinstallprompt",t=>{console.log("[PWA] beforeinstallprompt event fired"),t.preventDefault(),this.promptEvent=t,this.isInstallableSubject.next(!0)}),window.addEventListener("appinstalled",()=>{console.log("[PWA] App successfully installed"),this.isInstalledSubject.next(!0),this.isInstallableSubject.next(!1),this.promptEvent=null}),this.isRunningStandalone()&&this.isInstalledSubject.next(!0)}checkIfInstalled(){let t=this.isRunningStandalone(),e=window.matchMedia("(display-mode: standalone)").matches,s=/iPad|iPhone|iPod/.test(navigator.userAgent)&&navigator.standalone;(t||e||s)&&(console.log("[PWA] App detected as already installed"),this.isInstalledSubject.next(!0))}promptInstall(){return f(this,null,function*(){if(!this.promptEvent)return console.warn("[PWA] No install prompt available"),!1;try{this.promptEvent.prompt();let t=yield this.promptEvent.userChoice;return console.log("[PWA] User choice:",t),t.outcome==="accepted"?(console.log("[PWA] User accepted the install prompt"),this.isInstallableSubject.next(!1),!0):(console.log("[PWA] User dismissed the install prompt"),!1)}catch(t){return console.error("[PWA] Error prompting install:",t),!1}finally{this.promptEvent=null}})}isRunningStandalone(){return l(this.platformId)?window.matchMedia("(display-mode: standalone)").matches||navigator.standalone||document.referrer.includes("android-app://")||navigator.standalone===!0:!1}canInstall(){return this.promptEvent!==null}isInstalled(){return this.isInstalledSubject.value}isInstallable(){return this.isInstallableSubject.value}getPlatformInstallInstructions(){if(!l(this.platformId))return"Instrucciones disponibles en el navegador";let t=navigator.userAgent.toLowerCase();return/iphone|ipad|ipod/.test(t)?'iOS: Toca el bot\xF3n de compartir y selecciona "A\xF1adir a la pantalla de inicio"':/android/.test(t)?/chrome/.test(t)?'Android Chrome: Toca el men\xFA (3 puntos) y selecciona "A\xF1adir a la pantalla de inicio"':/firefox/.test(t)?'Android Firefox: Toca el men\xFA y selecciona "Instalar"':'Android: Busca la opci\xF3n "A\xF1adir a la pantalla de inicio" en el men\xFA del navegador':/windows/.test(t)?"Windows: Haz clic en el icono de instalaci\xF3n en la barra de direcciones":/mac/.test(t)?"Mac: Haz clic en el icono de instalaci\xF3n en la barra de direcciones":'Busca la opci\xF3n "Instalar app" o "A\xF1adir a la pantalla de inicio" en tu navegador'}isPwaSupported(){return l(this.platformId)?"serviceWorker"in navigator&&"PushManager"in window:!1}getPwaStatus(){if(!l(this.platformId))return{isSupported:!1,isInstallable:!1,isInstalled:!1,canPrompt:!1,platform:"server"};let t=navigator.userAgent.toLowerCase(),e="unknown";return/iphone|ipad|ipod/.test(t)?e="ios":/android/.test(t)?e="android":/windows/.test(t)?e="windows":/mac/.test(t)?e="mac":e="desktop",{isSupported:this.isPwaSupported(),isInstallable:this.isInstallable(),isInstalled:this.isInstalled(),canPrompt:this.canInstall(),platform:e}}static \u0275fac=function(e){return new(e||o)(A(m))};static \u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})}});function V(o,t){if(o&1){let e=S();n(0,"div",2)(1,"button",3),_("click",function(){I(e);let s=h();return C(s.installApp())}),n(2,"span",4),i(3,"\u{1F4F2}"),a(),n(4,"span",5),i(5,"Instalar App"),a()()()}}function G(o,t){o&1&&(n(0,"div",15)(1,"div",16)(2,"span",17),i(3,"1"),a(),n(4,"span",18),i(5,"Toca el bot\xF3n de compartir "),n(6,"span",19),i(7,"\u{1F4E4}"),a()()(),n(8,"div",16)(9,"span",17),i(10,"2"),a(),n(11,"span",18),i(12,'Selecciona "A\xF1adir a la pantalla de inicio"'),a()()())}function H(o,t){o&1&&(n(0,"div",15)(1,"div",16)(2,"span",17),i(3,"1"),a(),n(4,"span",18),i(5,"Toca el men\xFA "),n(6,"span",19),i(7,"\u22EE"),a()()(),n(8,"div",16)(9,"span",17),i(10,"2"),a(),n(11,"span",18),i(12,'Selecciona "A\xF1adir a la pantalla de inicio"'),a()()())}function q(o,t){o&1&&(n(0,"div",15)(1,"div",16)(2,"span",17),i(3,"1"),a(),n(4,"span",18),i(5,"Busca el icono de instalaci\xF3n en la barra de direcciones"),a()(),n(6,"div",16)(7,"span",17),i(8,"2"),a(),n(9,"span",18),i(10,'Haz clic en "Instalar" cuando aparezca'),a()()())}function Q(o,t){if(o&1){let e=S();n(0,"div",6)(1,"div",7)(2,"div",8)(3,"div",9),i(4,"\u{1F4A1}"),a(),n(5,"h4"),i(6,"A\xF1adir a pantalla de inicio"),a(),n(7,"button",10),_("click",function(){I(e);let s=h();return C(s.dismissManualInstructions())}),i(8," \u2715 "),a()(),n(9,"p",11),i(10),a(),n(11,"div",12),P(12,G,13,0,"div",13)(13,H,13,0,"div",13)(14,q,11,0,"div",14),a()()()}if(o&2){let e=h();d(10),j(e.installInstructions),d(),u("ngSwitch",e.pwaStatus.platform),d(),u("ngSwitchCase","ios"),d(),u("ngSwitchCase","android")}}var R,J=O(()=>{"use strict";b();x();x();M();b();L();N();x();R=class o{constructor(t,e,r){this.pwaService=t;this.router=e;this.platformId=r}userCard=null;showInstallBanner=!1;showManualInstructions=!1;isInstalled=!1;installInstructions="";pwaStatus={};currentCardUrl="";showDirectShortcut=!1;subscriptions=new y;ngOnInit(){this.currentCardUrl=this.getCurrentCardUrl(),this.subscriptions.add(this.pwaService.isInstallable$.subscribe(t=>{this.showInstallBanner=t&&!this.isInstalled&&this.userCard&&this.shouldShowBanner()})),this.subscriptions.add(this.pwaService.isInstalled$.subscribe(t=>{this.isInstalled=t,t&&(this.showInstallBanner=!1,this.showDirectShortcut=!1)})),this.pwaStatus=this.pwaService.getPwaStatus(),this.userCard&&!this.pwaStatus.isInstalled&&this.pwaStatus.isSupported&&(this.showDirectShortcut=!0,console.log("[PWA] Showing install button for user card:",this.userCard)),console.log("[PWA] PWA Status:",this.pwaStatus),console.log("[PWA] UserCard:",this.userCard),console.log("[PWA] ShowDirectShortcut:",this.showDirectShortcut)}ngOnDestroy(){this.subscriptions.unsubscribe()}installApp(){return f(this,null,function*(){if(!l(this.platformId))return;if(console.log("[PWA] Install button clicked"),yield this.pwaService.promptInstall()){this.showInstallBanner=!1,this.showDirectShortcut=!1;return}let e=navigator.userAgent.toLowerCase(),r=!/iphone|ipad|ipod|android/.test(e),s=this.userCard?.name||this.userCard?.nombre||"esta tarjeta";if(r){console.log("[PWA] Desktop detected - attempting direct installation"),this.pwaService.canInstall()&&console.log("[PWA] Prompt failed, trying alternative methods"),this.triggerBrowserInstallPrompt();return}let c="";/iphone|ipad|ipod/.test(e)?c=`Para instalar la tarjeta de ${s}:

1. Toca el bot\xF3n Compartir (\u{1F4E4}) en la parte inferior
2. Despl\xE1zate hacia abajo y selecciona "A\xF1adir a pantalla de inicio"
3. Toca "A\xF1adir" para confirmar

\xA1La tarjeta aparecer\xE1 como una app en tu pantalla de inicio!`:/android/.test(e)&&(/chrome/.test(e)?c=`Para instalar la tarjeta de ${s}:

1. Toca el men\xFA (\u22EE) en la esquina superior derecha
2. Selecciona "Instalar app" o "A\xF1adir a pantalla de inicio"
3. Toca "Instalar" para confirmar

\xA1La tarjeta se instalar\xE1 como una app!`:c=`Para instalar la tarjeta de ${s}:

1. Toca el men\xFA del navegador
2. Busca "A\xF1adir a pantalla de inicio" o "Instalar"
3. Confirma la instalaci\xF3n

\xA1La tarjeta aparecer\xE1 como una app!`),c&&alert(c)})}dismissBanner(){this.showInstallBanner=!1,typeof localStorage<"u"&&localStorage.setItem("pwa-install-dismissed",Date.now().toString())}dismissManualInstructions(){this.showManualInstructions=!1}shouldShowBanner(){if(typeof localStorage>"u")return!0;let t=localStorage.getItem("pwa-install-dismissed");if(!t)return!0;let e=parseInt(t),r=Date.now()-7*24*60*60*1e3;return e<r}getCurrentCardUrl(){return l(this.platformId)?window.location.href:""}getCustomInstallInstructions(){return l(this.platformId)?this.userCard?`A\xF1ade la tarjeta de ${this.userCard.name||this.userCard.nombre||"esta tarjeta"} a tu pantalla de inicio para acceso r\xE1pido`:this.pwaService.getPlatformInstallInstructions():"Instrucciones disponibles en el navegador"}createDirectShortcut(){l(this.platformId)&&this.installApp()}dismissDirectShortcut(){if(this.showDirectShortcut=!1,typeof localStorage<"u"&&this.userCard){let t=this.userCard.id||this.userCard.usuario_id||"unknown";localStorage.setItem(`pwa-shortcut-dismissed-${t}`,Date.now().toString())}}triggerBrowserInstallPrompt(){console.log("[PWA] Triggering browser install prompt for desktop");let t=navigator.userAgent.toLowerCase();/chrome/.test(t)||/chromium/.test(t)?this.dispatchInstallEvent():/firefox/.test(t)?this.createFirefoxShortcut():/edge/.test(t)?this.dispatchInstallEvent():this.createGenericShortcut()}dispatchInstallEvent(){try{let t=new CustomEvent("beforeinstallprompt",{bubbles:!0,cancelable:!0});t.prompt=()=>{console.log("[PWA] Custom prompt triggered"),this.showCustomInstallDialog()},window.dispatchEvent(t),t.prompt&&t.prompt()}catch(t){console.warn("[PWA] Could not dispatch install event:",t),this.createGenericShortcut()}}showCustomInstallDialog(){let t=this.userCard?.name||this.userCard?.nombre||"esta tarjeta";confirm(`\xBFQuieres instalar la tarjeta de ${t} como una aplicaci\xF3n?

Esto crear\xE1 un acceso directo en tu escritorio.`)&&this.createDesktopShortcut()}createFirefoxShortcut(){console.log("[PWA] Creating Firefox shortcut"),this.createGenericShortcut()}createGenericShortcut(){console.log("[PWA] Creating generic desktop shortcut");let t=window.location.href,e=this.userCard?.name||"Tarjeta Digital",r=window.open(t,"_blank","width=400,height=600,menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes");r&&(r.document.title=e,console.log("[PWA] Opened as app window"))}createDesktopShortcut(){console.log("[PWA] Attempting to create desktop shortcut");let t=window.location.href,e=this.userCard?.name||"Tarjeta Digital",r=`[InternetShortcut]
URL=${t}
IconIndex=0`,s=new Blob([r],{type:"text/plain"}),c=URL.createObjectURL(s),p=document.createElement("a");p.href=c,p.download=`${e}.url`,p.style.display="none",document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(c),console.log("[PWA] Desktop shortcut file created")}static \u0275fac=function(e){return new(e||o)(g(w),g(F),g(m))};static \u0275cmp=D({type:o,selectors:[["app-pwa-install"]],inputs:{userCard:"userCard"},standalone:!0,features:[E],decls:2,vars:2,consts:[["class","pwa-install-simple",4,"ngIf"],["class","pwa-manual-instructions",4,"ngIf"],[1,"pwa-install-simple"],[1,"install-simple-btn",3,"click"],[1,"install-icon"],[1,"install-text"],[1,"pwa-manual-instructions"],[1,"instructions-content"],[1,"instructions-header"],[1,"instructions-icon"],["aria-label","Cerrar",1,"close-btn",3,"click"],[1,"instructions-text"],[1,"platform-steps",3,"ngSwitch"],["class","platform-guide",4,"ngSwitchCase"],["class","platform-guide",4,"ngSwitchDefault"],[1,"platform-guide"],[1,"step"],[1,"step-number"],[1,"step-text"],[1,"icon-demo"]],template:function(e,r){e&1&&P(0,V,6,0,"div",0)(1,Q,15,4,"div",1),e&2&&(u("ngIf",(r.showInstallBanner||r.showDirectShortcut)&&r.userCard),d(),u("ngIf",r.showManualInstructions))},dependencies:[U,z,W,T,B],styles:[".pwa-install-simple[_ngcontent-%COMP%]{position:fixed;bottom:20px;right:20px;z-index:1000;animation:_ngcontent-%COMP%_slideInUp .3s ease-out}.install-simple-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);border:none;color:#fff;padding:16px 24px;border-radius:50px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:10px;box-shadow:0 8px 32px #667eea66;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2)}.install-simple-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px) scale(1.05);box-shadow:0 12px 40px #667eea99}.install-simple-btn[_ngcontent-%COMP%]:active{transform:translateY(0) scale(.98)}.install-icon[_ngcontent-%COMP%]{font-size:1.4rem;animation:_ngcontent-%COMP%_pulse 2s infinite}.install-text[_ngcontent-%COMP%]{font-weight:600;letter-spacing:.5px}@keyframes _ngcontent-%COMP%_pulse{0%,to{opacity:1}50%{opacity:.7}}.banner-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:16px 20px;border-radius:16px;box-shadow:0 8px 32px #0000004d;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}.banner-icon[_ngcontent-%COMP%]{font-size:2rem;flex-shrink:0}.banner-text[_ngcontent-%COMP%]{flex:1}.banner-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;margin:0 0 4px}.banner-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;margin:0;opacity:.9}.banner-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.install-btn[_ngcontent-%COMP%]{background:#fff3;border:1px solid rgba(255,255,255,.3);color:#fff;padding:8px 16px;border-radius:20px;font-size:.9rem;font-weight:500;cursor:pointer;transition:all .3s ease}.install-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d;transform:translateY(-1px)}.dismiss-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#ffffffb3;font-size:1.2rem;cursor:pointer;padding:4px;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.dismiss-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.pwa-direct-shortcut[_ngcontent-%COMP%]{position:fixed;bottom:20px;left:20px;right:20px;z-index:1000;max-width:400px;margin:0 auto;animation:_ngcontent-%COMP%_slideInUp .3s ease-out}.shortcut-content[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);color:#fff;padding:20px;border-radius:16px;box-shadow:0 8px 32px #10b9814d;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.1)}.shortcut-header[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px;margin-bottom:16px}.shortcut-icon[_ngcontent-%COMP%]{font-size:2rem;flex-shrink:0}.shortcut-text[_ngcontent-%COMP%]{flex:1}.shortcut-text[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;margin:0 0 4px}.shortcut-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.95rem;margin:0;opacity:.9}.shortcut-actions[_ngcontent-%COMP%]{display:flex;justify-content:center}.shortcut-btn[_ngcontent-%COMP%]{background:#fff3;border:1px solid rgba(255,255,255,.3);color:#fff;padding:12px 24px;border-radius:25px;font-size:1rem;font-weight:500;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:8px}.shortcut-btn[_ngcontent-%COMP%]:hover{background:#ffffff4d;transform:translateY(-2px);box-shadow:0 4px 12px #0003}.btn-icon[_ngcontent-%COMP%]{font-size:1.1rem}.pwa-manual-instructions[_ngcontent-%COMP%]{position:fixed;top:20px;left:20px;right:20px;z-index:1000;max-width:450px;margin:0 auto;animation:_ngcontent-%COMP%_slideInDown .3s ease-out}.instructions-content[_ngcontent-%COMP%]{background:#000000e6;color:#fff;padding:20px;border-radius:16px;box-shadow:0 8px 32px #00000080;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.1)}.instructions-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:16px;position:relative}.instructions-icon[_ngcontent-%COMP%]{font-size:1.5rem}.instructions-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{flex:1;font-size:1.2rem;font-weight:600;margin:0}.close-btn[_ngcontent-%COMP%]{background:transparent;border:none;color:#ffffffb3;font-size:1.2rem;cursor:pointer;padding:4px;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;transition:all .3s ease}.close-btn[_ngcontent-%COMP%]:hover{background:#ffffff1a;color:#fff}.instructions-text[_ngcontent-%COMP%]{font-size:.95rem;line-height:1.5;margin:0 0 16px;opacity:.9}.platform-guide[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.step[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px}.step-number[_ngcontent-%COMP%]{background:linear-gradient(135deg,#0ff,#8000ff);color:#fff;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.8rem;font-weight:600;flex-shrink:0}.step-text[_ngcontent-%COMP%]{font-size:.9rem;line-height:1.4;padding-top:2px}.icon-demo[_ngcontent-%COMP%]{background:#ffffff1a;padding:2px 6px;border-radius:4px;margin:0 4px;font-size:.8rem}@keyframes _ngcontent-%COMP%_slideInUp{0%{opacity:0;transform:translateY(100px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_slideInDown{0%{opacity:0;transform:translateY(-100px)}to{opacity:1;transform:translateY(0)}}@media (max-width: 480px){.pwa-install-simple[_ngcontent-%COMP%]{bottom:16px;right:16px}.install-simple-btn[_ngcontent-%COMP%]{padding:14px 20px;font-size:.9rem}.install-icon[_ngcontent-%COMP%]{font-size:1.2rem}.pwa-manual-instructions[_ngcontent-%COMP%]{left:16px;right:16px;top:16px}.instructions-content[_ngcontent-%COMP%]{padding:18px}}@media (prefers-color-scheme: dark){.instructions-content[_ngcontent-%COMP%]{background:#141414f2;border:1px solid rgba(255,255,255,.15)}}@media (prefers-contrast: high){.banner-content[_ngcontent-%COMP%], .instructions-content[_ngcontent-%COMP%], .install-btn[_ngcontent-%COMP%]{border:2px solid white}}"]})}});export{R as a,J as b};
